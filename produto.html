<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Accessory Store â€“ Produto</title>

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),
          dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NTLKR2NJ');
  </script>
  <!-- End Google Tag Manager -->

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 40px;
    }
    .product {
      background: #fff;
      padding: 30px;
      max-width: 500px;
      margin: auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .price {
      color: green;
      font-size: 22px;
      margin: 10px 0;
    }
    button {
      background: #007bff;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>

<body>

<!-- Google Tag Manager (noscript) -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NTLKR2NJ"
          height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="product">
  <h1 id="product-name"></h1>
  <p id="product-category"></p>
  <div class="price" id="product-price"></div>
  <button id="add-to-cart">Adicionar ao carrinho</button>
</div>

<script>
  // Produtos fake (demo)
  const products = {
    A001: {
      item_id: 'A001',
      item_name: 'Wireless Headphones Pro',
      item_category: 'Audio',
      price: 99.00
    }
  };

  // Captura ID do produto pela URL
  const params = new URLSearchParams(window.location.search);
  const productId = params.get('id');
  const product = products[productId];

  // Renderiza produto
  if (product) {
    document.getElementById('product-name').innerText = product.item_name;
    document.getElementById('product-category').innerText = product.item_category;
    document.getElementById('product-price').innerText = `US$ ${product.price.toFixed(2)}`;

    // Dispara view_item
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event: 'view_item',
      ecommerce: {
        currency: 'USD',
        value: product.price,
        items: [product]
      }
    });
  }

  // Add to cart
  document.getElementById('add-to-cart').addEventListener('click', function () {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    const existingItem = cart.find(item => item.item_id === product.item_id);

    if (existingItem) {
      existingItem.quantity += 1;
    } else {
      cart.push({
        ...product,
        quantity: 1
      });
    }

    localStorage.setItem('cart', JSON.stringify(cart));

    // Dispara add_to_cart
    window.dataLayer.push({
      event: 'add_to_cart',
      ecommerce: {
        currency: 'USD',
        value: product.price,
        items: [{
          ...product,
          quantity: 1
        }]
      }
    });

    // Redireciona para carrinho
    window.location.href = 'carrinho.html';
  });
</script>

</body>
</html>
